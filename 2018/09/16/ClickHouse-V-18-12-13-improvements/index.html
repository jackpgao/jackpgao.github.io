<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="新特性," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="ClickHouse的发版速度是众所周知的快在最近，他们正式发出了18.12.13-2018-09-10版本相关的CHANGELOG更是多的吓人为了能够更好的使用新版特性，特做了详细的介绍
其中新特性部分，为人工翻译、校对，毕竟这部分内容是重点，后面为Google翻译">
<meta property="og:type" content="article">
<meta property="og:title" content="ClickHouse 18.12.13-2018-09-10版本新特性解析">
<meta property="og:url" content="http://jackpgao.github.io/2018/09/16/ClickHouse-V-18-12-13-improvements/index.html">
<meta property="og:site_name" content="Jack Gao's Blog">
<meta property="og:description" content="ClickHouse的发版速度是众所周知的快在最近，他们正式发出了18.12.13-2018-09-10版本相关的CHANGELOG更是多的吓人为了能够更好的使用新版特性，特做了详细的介绍
其中新特性部分，为人工翻译、校对，毕竟这部分内容是重点，后面为Google翻译">
<meta property="og:image" content="http://7xs54v.com1.z0.glb.clouddn.com/15369832465493.jpg">
<meta property="og:updated_time" content="2018-09-15T16:39:07.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ClickHouse 18.12.13-2018-09-10版本新特性解析">
<meta name="twitter:description" content="ClickHouse的发版速度是众所周知的快在最近，他们正式发出了18.12.13-2018-09-10版本相关的CHANGELOG更是多的吓人为了能够更好的使用新版特性，特做了详细的介绍
其中新特性部分，为人工翻译、校对，毕竟这部分内容是重点，后面为Google翻译">
<meta name="twitter:image" content="http://7xs54v.com1.z0.glb.clouddn.com/15369832465493.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: 'YZ27AIO4SX',
      apiKey: '9b9cf00eff4aac0ae53f6891931c3b5a',
      indexName: 'jackpgao.github.io',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://jackpgao.github.io/2018/09/16/ClickHouse-V-18-12-13-improvements/"/>





  <title> ClickHouse 18.12.13-2018-09-10版本新特性解析 | Jack Gao's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jack Gao's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">All great achievements require time.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://jackpgao.github.io/2018/09/16/ClickHouse-V-18-12-13-improvements/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jack Gao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jack Gao's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                ClickHouse 18.12.13-2018-09-10版本新特性解析
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T00:25:43+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ClickHouse/" itemprop="url" rel="index">
                    <span itemprop="name">ClickHouse</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/16/ClickHouse-V-18-12-13-improvements/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/09/16/ClickHouse-V-18-12-13-improvements/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://7xs54v.com1.z0.glb.clouddn.com/15369832465493.jpg" alt=""></p>
<blockquote>
<p>ClickHouse的发版速度是众所周知的快<br>在最近，他们正式发出了18.12.13-2018-09-10版本<br>相关的CHANGELOG更是多的吓人<br>为了能够更好的使用新版特性，特做了详细的介绍</p>
<p>其中新特性部分，为人工翻译、校对，毕竟这部分内容是重点，后面为Google翻译</p>
</blockquote>
<a id="more"></a>
<h2 id="新特性列表（按照GitHub中CHANGELOG顺序）"><a href="#新特性列表（按照GitHub中CHANGELOG顺序）" class="headerlink" title="新特性列表（按照GitHub中CHANGELOG顺序）"></a>新特性列表（按照GitHub中CHANGELOG顺序）</h2><h4 id="支持Decimal"><a href="#支持Decimal" class="headerlink" title="支持Decimal"></a>支持Decimal</h4><ul>
<li>Added the DECIMAL(digits, scale) data type (Decimal32(scale), Decimal64(scale), Decimal128(scale)). To enable it, use the setting allow_experimental_decimal_type. #2846 #2970 #3008 #3047</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">FROM data_type_families</div><div class="line">WHERE name LIKE &apos;%De%&apos;</div><div class="line"></div><div class="line">┌─name───────┬─case_insensitive─┬─alias_to─┐</div><div class="line">│ Decimal32  │                1 │          │</div><div class="line">│ Decimal64  │                1 │          │</div><div class="line">│ Decimal128 │                1 │          │</div><div class="line">│ Decimal    │                1 │          │</div><div class="line">└────────────┴──────────────────┴──────────┘</div></pre></td></tr></table></figure>
<h4 id="新的WITH-ROLLUP修饰符GROUP-BY，替代语法-GROUP-BY-ROLLUP-…"><a href="#新的WITH-ROLLUP修饰符GROUP-BY，替代语法-GROUP-BY-ROLLUP-…" class="headerlink" title="新的WITH ROLLUP修饰符GROUP BY，替代语法 GROUP BY ROLLUP(…)"></a>新的WITH ROLLUP修饰符GROUP BY，替代语法 GROUP BY ROLLUP(…)</h4><ul>
<li>New WITH ROLLUP modifier for GROUP BY (alternative syntax: GROUP BY ROLLUP(…)). #2948</li>
</ul>
<h4 id="JOIN查询会把-解析为字段"><a href="#JOIN查询会把-解析为字段" class="headerlink" title="JOIN查询会把*解析为字段"></a>JOIN查询会把*解析为字段</h4><ul>
<li>In requests with JOIN, the star character expands to a list of columns in all tables, in compliance with the SQL standard. You can restore the old behavior by setting - asterisk_left_columns_only to 1 on the user configuration level. Winter Zhang</li>
</ul>
<h4 id="JOIN支持table-functions-remote-merge-numbers-url"><a href="#JOIN支持table-functions-remote-merge-numbers-url" class="headerlink" title="JOIN支持table functions(remote/merge/numbers/url)"></a>JOIN支持table functions(remote/merge/numbers/url)</h4><ul>
<li>Added support for JOIN with table functions. Winter Zhang</li>
</ul>
<h4 id="终端支持tab自动补全"><a href="#终端支持tab自动补全" class="headerlink" title="终端支持tab自动补全"></a>终端支持tab自动补全</h4><ul>
<li>Autocomplete by pressing Tab in clickhouse-client. Sergey Shcherbin</li>
</ul>
<h4 id="终端支持ctrl-c取消输入"><a href="#终端支持ctrl-c取消输入" class="headerlink" title="终端支持ctrl c取消输入"></a>终端支持ctrl c取消输入</h4><ul>
<li>Ctrl+C in clickhouse-client clears a query that was entered. #2877</li>
</ul>
<h4 id="可指定默认的JOIN行为"><a href="#可指定默认的JOIN行为" class="headerlink" title="可指定默认的JOIN行为"></a>可指定默认的JOIN行为</h4><ul>
<li>Added the join_default_strictness setting (values: “, ‘any’, ‘all’). This allows you to not specify ANY or ALL for JOIN. #2982</li>
</ul>
<h4 id="server-log关联查询ID"><a href="#server-log关联查询ID" class="headerlink" title="server log关联查询ID"></a>server log关联查询ID</h4><ul>
<li>Each line of the server log related to query processing shows the query ID. #2482</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">2018.09.15 23:01:12.934700 [ 275 ] &#123;b7a52046-e852-41c9-9e13-54533917bc56&#125; &lt;Debug&gt; executeQuery: (from xx.xx.80.34:37066, user: user) select * from numbers(100)</div><div class="line">2018.09.15 23:01:12.934984 [ 275 ] &#123;b7a52046-e852-41c9-9e13-54533917bc56&#125; &lt;Trace&gt; InterpreterSelectQuery: FetchColumns -&gt; Complete</div><div class="line">2018.09.15 23:01:12.935029 [ 86 ] &lt;Trace&gt; SystemLog (system.query_log): Flushing system log</div><div class="line">2018.09.15 23:01:12.935036 [ 275 ] &#123;b7a52046-e852-41c9-9e13-54533917bc56&#125; &lt;Debug&gt; executeQuery: Query pipeline:</div><div class="line">Expression</div><div class="line"> Expression</div><div class="line">  Limit</div><div class="line">   Numbers</div><div class="line"></div><div class="line">2018.09.15 23:01:12.935391 [ 277 ] &#123;b7a52046-e852-41c9-9e13-54533917bc56&#125; &lt;Trace&gt; ThreadStatus: Thread 277 exited</div><div class="line">2018.09.15 23:01:12.935449 [ 87 ] &lt;Trace&gt; SystemLog (system.query_thread_log): Flushing system log</div><div class="line">2018.09.15 23:01:12.935517 [ 275 ] &#123;b7a52046-e852-41c9-9e13-54533917bc56&#125; &lt;Information&gt; executeQuery: Read 100 rows, 800.00 B in 0.001 sec., 146631 rows/sec., 1.12 MiB/sec.</div><div class="line">2018.09.15 23:01:12.935557 [ 275 ] &lt;Debug&gt; MemoryTracker: Peak memory usage (total): 1.00 MiB.</div><div class="line">2018.09.15 23:01:12.935572 [ 275 ] &lt;Information&gt; TCPHandler: Processed in 0.001 sec.</div></pre></td></tr></table></figure>
<h4 id="终端可以直接print日志"><a href="#终端可以直接print日志" class="headerlink" title="终端可以直接print日志"></a>终端可以直接print日志</h4><ul>
<li>Now you can get query execution logs in clickhouse-client (use the send_logs_level setting). With distributed query processing, logs are cascaded from all the servers. #2482</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">FROM system.settings</div><div class="line">WHERE name = &apos;send_logs_level&apos;</div><div class="line"></div><div class="line">┌─name────────────┬─value─┬─changed─┬─description──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</div><div class="line">│ send_logs_level │ none  │       0 │ Send server text logs with specified minumum level to client. Valid values: &apos;trace&apos;, &apos;debug&apos;, &apos;info&apos;, &apos;warning&apos;, &apos;error&apos;, &apos;none&apos; │</div><div class="line">└─────────────────┴───────┴─────────┴──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</div><div class="line"></div><div class="line">1 rows in set. Elapsed: 0.002 sec.</div><div class="line"></div><div class="line">xx.xx.xx.xx. :) set send_logs_level = &apos;trace&apos;;</div><div class="line"></div><div class="line">SET send_logs_level = &apos;trace&apos;</div><div class="line"></div><div class="line">Ok.</div><div class="line"></div><div class="line">0 rows in set. Elapsed: 0.001 sec.</div><div class="line"></div><div class="line">xx.xx.xx.xx. :) select * from system.settings where name = &apos;send_logs_level&apos; ;</div><div class="line"></div><div class="line">SELECT *</div><div class="line">FROM system.settings</div><div class="line">WHERE name = &apos;send_logs_level&apos;</div><div class="line"></div><div class="line">[xx.xx.xx.xx.] 2018.09.15 23:30:51.158294 &#123;dbecff24-3edc-4584-8379-02cb23aedcb2&#125; [ 275 ] &lt;Debug&gt; executeQuery: (from 127.0.0.1:59056, user: user) select * from system.settings where name = &apos;send_logs_level&apos;</div><div class="line">[xx.xx.xx.xx.] 2018.09.15 23:30:51.159056 &#123;dbecff24-3edc-4584-8379-02cb23aedcb2&#125; [ 275 ] &lt;Trace&gt; InterpreterSelectQuery: FetchColumns -&gt; Complete</div><div class="line">[xx.xx.xx.xx.] 2018.09.15 23:30:51.159152 &#123;dbecff24-3edc-4584-8379-02cb23aedcb2&#125; [ 275 ] &lt;Debug&gt; executeQuery: Query pipeline:</div><div class="line">Expression</div><div class="line"> Expression</div><div class="line">  Filter</div><div class="line">   One</div><div class="line"></div><div class="line">┌─name────────────┬─value─┬─changed─┬─description──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</div><div class="line">│ send_logs_level │ trace │       1 │ Send server text logs with specified minumum level to client. Valid values: &apos;trace&apos;, &apos;debug&apos;, &apos;info&apos;, &apos;warning&apos;, &apos;error&apos;, &apos;none&apos; │</div><div class="line">└─────────────────┴───────┴─────────┴──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</div><div class="line">[xx.xx.xx.xx.] 2018.09.15 23:30:51.159654 &#123;dbecff24-3edc-4584-8379-02cb23aedcb2&#125; [ 398 ] &lt;Trace&gt; ThreadStatus: Thread 398 exited</div><div class="line">[xx.xx.xx.xx.] 2018.09.15 23:30:51.159803 &#123;dbecff24-3edc-4584-8379-02cb23aedcb2&#125; [ 275 ] &lt;Information&gt; executeQuery: Read 178 rows, 25.15 KiB in 0.001 sec., 127014 rows/sec., 17.53 MiB/sec.</div><div class="line"></div><div class="line"></div><div class="line"># 分布式查询的日志也会打到当前终端</div></pre></td></tr></table></figure>
<h4 id="记录setting行为到query-log"><a href="#记录setting行为到query-log" class="headerlink" title="记录setting行为到query_log"></a>记录setting行为到query_log</h4><ul>
<li>The system.query_log and system.processes (SHOW PROCESSLIST) tables now have information about all changed settings when you run a query (the nested structure of the Settings data). - Added the log_query_settings setting. #2482</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">FROM system.query_log</div><div class="line">ORDER BY event_time DESC</div><div class="line">LIMIT 1</div><div class="line"></div><div class="line">Row 1:</div><div class="line">──────</div><div class="line">type:                 1</div><div class="line">event_date:           2018-09-15</div><div class="line">event_time:           2018-09-15 23:42:17</div><div class="line">query_start_time:     2018-09-15 23:42:17</div><div class="line">query_duration_ms:    0</div><div class="line">read_rows:            0</div><div class="line">read_bytes:           0</div><div class="line">written_rows:         0</div><div class="line">written_bytes:        0</div><div class="line">result_rows:          0</div><div class="line">result_bytes:         0</div><div class="line">memory_usage:         0</div><div class="line">query:                select * from system.metrics</div><div class="line">exception:</div><div class="line">stack_trace:</div><div class="line">is_initial_query:     1</div><div class="line">user:                 user</div><div class="line">query_id:             0881d528-a79c-4bd7-8c0a-38ce270b95f1</div><div class="line">address:              ��</div><div class="line">M�</div><div class="line">port:                 33384</div><div class="line">initial_user:         user</div><div class="line">initial_query_id:     0881d528-a79c-4bd7-8c0a-38ce270b95f1</div><div class="line">initial_address:      ��</div><div class="line">M�</div><div class="line">initial_port:         33384</div><div class="line">interface:            2</div><div class="line">os_user:</div><div class="line">client_hostname:</div><div class="line">client_name:</div><div class="line">client_revision:      0</div><div class="line">client_version_major: 0</div><div class="line">client_version_minor: 0</div><div class="line">client_version_patch: 0</div><div class="line">http_method:          1</div><div class="line">http_user_agent:      Go-http-client/1.1</div><div class="line">quota_key:</div><div class="line">revision:             54407</div><div class="line">thread_numbers:       []</div><div class="line">ProfileEvents.Names:  []</div><div class="line">ProfileEvents.Values: []</div><div class="line">Settings.Names:       [&apos;max_threads&apos;,&apos;use_uncompressed_cache&apos;,&apos;background_pool_size&apos;,&apos;load_balancing&apos;,&apos;log_queries&apos;,&apos;readonly&apos;,&apos;max_memory_usage&apos;]</div><div class="line">Settings.Values:      [&apos;48&apos;,&apos;0&apos;,&apos;64&apos;,&apos;random&apos;,&apos;1&apos;,&apos;1&apos;,&apos;32212254720&apos;]</div></pre></td></tr></table></figure>
<h4 id="记录线程数"><a href="#记录线程数" class="headerlink" title="记录线程数"></a>记录线程数</h4><ul>
<li>The system.query_log and system.processes tables now show information about the number of threads that are participating in query execution (see the thread_numbers column). #2482</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">SELECT thread_numbers</div><div class="line">FROM system.query_log</div><div class="line">ORDER BY event_time DESC</div><div class="line">LIMIT 10</div><div class="line"></div><div class="line">┌─thread_numbers─┐</div><div class="line">│ []             │</div><div class="line">│ [88]           │</div><div class="line">│ []             │</div><div class="line">│ [77,173]       │</div><div class="line">│ []             │</div><div class="line">│ []             │</div><div class="line">│ [77,174]       │</div><div class="line">│ []             │</div><div class="line">│ [77,171]       │</div><div class="line">│ []             │</div><div class="line">└────────────────┘</div><div class="line"></div><div class="line"></div><div class="line">SELECT thread_numbers</div><div class="line">FROM system.processes</div><div class="line">LIMIT 10</div><div class="line"></div><div class="line">┌─thread_numbers─┐</div><div class="line">│ [77]           │</div><div class="line">└────────────────┘</div></pre></td></tr></table></figure>
<h4 id="增加进程统计信息"><a href="#增加进程统计信息" class="headerlink" title="增加进程统计信息"></a>增加进程统计信息</h4><ul>
<li><p>Added ProfileEvents counters that measure the time spent on reading and writing over the network and reading and writing to disk, the number of network errors, and the time spent - waiting when network bandwidth is limited. #2482</p>
</li>
<li><p>Added ProfileEventscounters that contain the system metrics from rusage (you can use them to get information about CPU usage in userspace and the kernel, page faults, and context -<br>switches), as well as taskstats metrics (use these to obtain information about I/O wait time, CPU wait time, and the amount of data read and recorded, both with and without page c ache). -#2482</p>
</li>
<li><p>The ProfileEvents counters are applied globally and for each query, as well as for each query execution thread, which allows you to profile resource consumption by query in detail. #2482</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">FROM system.processes</div><div class="line">LIMIT 10</div><div class="line"></div><div class="line">Row 1:</div><div class="line">──────</div><div class="line">is_initial_query:     1</div><div class="line">user:                 user</div><div class="line">query_id:             7e65449f-8899-4c5f-8859-20eeae32d1b1</div><div class="line">address:              127.0.0.1</div><div class="line">port:                 38610</div><div class="line">initial_user:         user</div><div class="line">initial_query_id:     7e65449f-8899-4c5f-8859-20eeae32d1b1</div><div class="line">initial_address:      127.0.0.1</div><div class="line">initial_port:         38610</div><div class="line">interface:            1</div><div class="line">os_user:              root</div><div class="line">client_hostname:      xx.xx.xx.xx.</div><div class="line">client_name:          ClickHouse client</div><div class="line">client_version_major: 18</div><div class="line">client_version_minor: 12</div><div class="line">client_version_patch: 13</div><div class="line">client_revision:      54407</div><div class="line">http_method:          0</div><div class="line">http_user_agent:</div><div class="line">quota_key:</div><div class="line">elapsed:              0.000800632</div><div class="line">is_cancelled:         0</div><div class="line">read_rows:            0</div><div class="line">read_bytes:           0</div><div class="line">total_rows_approx:    0</div><div class="line">written_rows:         0</div><div class="line">written_bytes:        0</div><div class="line">memory_usage:         880</div><div class="line">peak_memory_usage:    880</div><div class="line">query:                select * from system.processes  limit 10</div><div class="line">thread_numbers:       [181]</div><div class="line">ProfileEvents.Names:  [&apos;Query&apos;,&apos;SelectQuery&apos;,&apos;ReadCompressedBytes&apos;,&apos;CompressedReadBufferBlocks&apos;,&apos;CompressedReadBufferBytes&apos;,&apos;IOBufferAllocs&apos;,&apos;IOBufferAllocBytes&apos;,&apos;ContextLock&apos;,&apos;RWLockAcquiredReadLocks&apos;]</div><div class="line">ProfileEvents.Values: [1,1,36,1,10,1,57,3,1]</div><div class="line">Settings.Names:       [&apos;max_threads&apos;,&apos;use_uncompressed_cache&apos;,&apos;background_pool_size&apos;,&apos;load_balancing&apos;,&apos;log_queries&apos;,&apos;max_memory_usage&apos;]</div><div class="line">Settings.Values:      [&apos;48&apos;,&apos;0&apos;,&apos;64&apos;,&apos;random&apos;,&apos;1&apos;,&apos;64424509440&apos;]</div></pre></td></tr></table></figure>
<h4 id="新增每个查询执行线程的信息"><a href="#新增每个查询执行线程的信息" class="headerlink" title="新增每个查询执行线程的信息"></a>新增每个查询执行线程的信息</h4><ul>
<li>Added the system.query_thread_log table, which contains information about each query execution thread. Added the log_query_threads setting. #2482</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">FROM system.query_thread_log</div><div class="line">ORDER BY event_time DESC</div><div class="line">LIMIT 3</div><div class="line"></div><div class="line">Row 1:</div><div class="line">──────</div><div class="line">event_date:           2018-09-15</div><div class="line">event_time:           2018-09-15 22:29:17</div><div class="line">query_start_time:     2018-09-15 22:29:17</div><div class="line">query_duration_ms:    4</div><div class="line">read_rows:            2178</div><div class="line">read_bytes:           1446750</div><div class="line">written_rows:         0</div><div class="line">written_bytes:        0</div><div class="line">memory_usage:         27136</div><div class="line">peak_memory_usage:    44996168</div><div class="line">thread_name:          ParalInputsProc</div><div class="line">thread_number:        252</div><div class="line">os_thread_id:         19255</div><div class="line">master_thread_number: 74</div><div class="line">master_os_thread_id:  9227</div><div class="line">query:                select * from system.query_thread_log order by event_time desc  limit 10</div><div class="line">is_initial_query:     1</div><div class="line">user:                 user</div><div class="line">query_id:             55740e27-e796-4b0f-a9ff-530363f91d76</div><div class="line">address:              ��</div><div class="line">port:                 52456</div><div class="line">initial_user:         user</div><div class="line">initial_query_id:     55740e27-e796-4b0f-a9ff-530363f91d76</div><div class="line">initial_address:      ��</div><div class="line">initial_port:         52456</div><div class="line">interface:            1</div><div class="line">os_user:              root</div><div class="line">client_hostname:      xx.xx.xx.xx.</div><div class="line">client_name:          ClickHouse client</div><div class="line">client_revision:      54407</div><div class="line">client_version_major: 18</div><div class="line">client_version_minor: 12</div><div class="line">client_version_patch: 13</div><div class="line">http_method:          0</div><div class="line">http_user_agent:</div><div class="line">quota_key:</div><div class="line">revision:             54407</div><div class="line">ProfileEvents.Names:  [&apos;FileOpen&apos;,&apos;ReadBufferFromFileDescriptorRead&apos;,&apos;ReadBufferFromFileDescriptorReadBytes&apos;,&apos;ReadCompressedBytes&apos;,&apos;CompressedReadBufferBlocks&apos;,&apos;CompressedReadBufferBytes&apos;,&apos;IOBufferAllocs&apos;,&apos;IOBufferAllocBytes&apos;,&apos;MarkCacheMisses&apos;,&apos;CreatedReadBufferOrdinary&apos;,&apos;DiskReadElapsedMicroseconds&apos;,&apos;ContextLock&apos;,&apos;RealTimeMicroseconds&apos;,&apos;UserTimeMicroseconds&apos;,&apos;SystemTimeMicroseconds&apos;,&apos;SoftPageFaults&apos;]</div><div class="line">ProfileEvents.Values: [80,118,231033,229113,46,1101082,80,42862276,40,40,1135,2,4328,890,2671,678]</div></pre></td></tr></table></figure>
<h4 id="新增-system-metrics-and-system-events"><a href="#新增-system-metrics-and-system-events" class="headerlink" title="新增 system.metrics and system.events"></a>新增 system.metrics and system.events</h4><ul>
<li>The system.metrics and system.events tables now have built-in documentation. #3016</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">FROM system.metrics</div><div class="line"></div><div class="line">┌─metric───────────────────────────────────┬──────value─┬─description────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</div><div class="line">│ Query                                    │          1 │ Number of executing queries                                                                                                                                                                                                                                │</div><div class="line">│ Merge                                    │          0 │ Number of executing background merges                                                                                                                                                                                                                      │</div><div class="line">│ PartMutation                             │          0 │ Number of mutations (ALTER DELETE/UPDATE)                                                                                                                                                                                                                  │</div><div class="line">│ ReplicatedFetch                          │          0 │ Number of data parts fetching from replica                                                                                                                                                                                                                 │</div><div class="line">│ ReplicatedSend                           │          0 │ Number of data parts sending to replicas                                                                                                                                                                                                                   │</div><div class="line">│ ReplicatedChecks                         │          0 │ Number of data parts checking for consistency</div><div class="line"></div><div class="line"></div><div class="line">SELECT *</div><div class="line">FROM system.events</div><div class="line">LIMIT 10</div><div class="line"></div><div class="line">┌─event───────────────────────────────────┬────value─┬─description────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐</div><div class="line">│ Query                                   │      127 │ Number of queries started to be interpreted and maybe executed. Does not include queries that are failed to parse, that are rejected due to AST size limits; rejected due to quota limits or limits on number of simultaneously running queries. May include internal queries initiated by ClickHouse itself. Does not count subqueries. │</div><div class="line">│ SelectQuery                             │      124 │ Same as Query, but only for SELECT queries.                                                                                                                                                                                                                │</div><div class="line">│ FileOpen                                │    54504 │ Number of files opened.                                                                                                                                                                                                                                    │</div><div class="line">│ Seek                                    │       47 │ Number of times the &apos;lseek&apos; function was called.</div></pre></td></tr></table></figure>
<h4 id="新增arrayEnumerateDense函数"><a href="#新增arrayEnumerateDense函数" class="headerlink" title="新增arrayEnumerateDense函数"></a>新增arrayEnumerateDense函数</h4><ul>
<li>Added the arrayEnumerateDense function. Amos Bird</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">SELECT arrayEnumerateDense([(1, 2), (3, 4), (1, 2), (1, 2), (2, 3), (2, 3)])</div><div class="line"></div><div class="line">┌─arrayEnumerateDense(array(tuple(1, 2), tuple(3, 4), tuple(1, 2), tuple(1, 2), tuple(2, 3), tuple(2, 3)))─┐</div><div class="line">│ [1,2,1,1,3,3]                                                                                            │</div><div class="line">└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘</div></pre></td></tr></table></figure>
<h4 id="新增arrayCumSumNonNegativ-arrayDifference函数"><a href="#新增arrayCumSumNonNegativ-arrayDifference函数" class="headerlink" title="新增arrayCumSumNonNegativ/arrayDifference函数"></a>新增arrayCumSumNonNegativ/arrayDifference函数</h4><ul>
<li><p>Added the arrayCumSumNonNegative and arrayDifference functions. Aleksey Studnev</p>
</li>
<li><p>似乎还没上，无法使用。</p>
</li>
</ul>
<h4 id="新增retention函数"><a href="#新增retention函数" class="headerlink" title="新增retention函数"></a>新增retention函数</h4><ul>
<li>Added the retention aggregate function. Sundy Li</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">SELECT</div><div class="line">    uid,</div><div class="line">    retention(date = &apos;2018-08-06&apos;, date = &apos;2018-08-07&apos;, date = &apos;2018-08-08&apos;) AS r</div><div class="line">FROM retention_test</div><div class="line">WHERE date IN (&apos;2018-08-06&apos;, &apos;2018-08-07&apos;, &apos;2018-08-08&apos;)</div><div class="line">GROUP BY uid</div><div class="line">ORDER BY uid ASC</div><div class="line">LIMIT 3</div><div class="line"></div><div class="line">┌─uid─┬─r───────┐</div><div class="line">│   0 │ [1,1,1] │</div><div class="line">│   1 │ [1,1,1] │</div><div class="line">│   2 │ [1,1,1] │</div><div class="line">└─────┴─────────┘</div></pre></td></tr></table></figure>
<h4 id="states函数可以使用加号云算法"><a href="#states函数可以使用加号云算法" class="headerlink" title="states函数可以使用加号云算法"></a>states函数可以使用加号云算法</h4><ul>
<li>Now you can add (merge) states of aggregate functions by using the plus operator, and multiply the states of aggregate functions by a nonnegative constant. #3062 #3034</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE add_aggregate</div><div class="line">(</div><div class="line">    a UInt32,</div><div class="line">    b UInt32</div><div class="line">)</div><div class="line">ENGINE = Memory</div><div class="line"></div><div class="line">INSERT INTO add_aggregate VALUES(1, 2);</div><div class="line"></div><div class="line">INSERT INTO add_aggregate VALUES(3, 1);</div><div class="line"></div><div class="line"></div><div class="line">SELECT minMerge(x)</div><div class="line">FROM</div><div class="line">(</div><div class="line">    SELECT minState(a) + minState(b) AS x</div><div class="line">    FROM add_aggregate</div><div class="line">)</div><div class="line"></div><div class="line">┌─minMerge(x)─┐</div><div class="line">│           1 │</div><div class="line">└─────────────┘</div></pre></td></tr></table></figure>
<h4 id="虚拟列"><a href="#虚拟列" class="headerlink" title="虚拟列"></a>虚拟列</h4><ul>
<li>Tables in the MergeTree family now have the virtual column _partition_id. #3089</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">SELECT _partition_id</div><div class="line">FROM test.partition_id</div><div class="line">ORDER BY _partition_id ASC</div><div class="line"></div><div class="line">┌─_partition_id─┐</div><div class="line">│ 197004        │</div><div class="line">│ 197004        │</div><div class="line">│ 197007        │</div><div class="line">│ 197007        │</div><div class="line">│ 197010        │</div><div class="line">│ 197010        │</div><div class="line">│ 201809        │</div><div class="line">│ 201809        │</div><div class="line">│ 201809        │</div><div class="line">└───────────────┘</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">SELECT *</div><div class="line">FROM test.partition_id</div><div class="line">ORDER BY d ASC</div><div class="line"></div><div class="line">┌──────────d─┬───x─┐</div><div class="line">│ 1970-04-11 │   1 │</div><div class="line">│ 1970-04-11 │   1 │</div><div class="line">│ 1970-07-20 │   2 │</div><div class="line">│ 1970-07-20 │   2 │</div><div class="line">│ 1970-10-28 │   3 │</div><div class="line">│ 1970-10-28 │   3 │</div><div class="line">│ 2018-09-13 │ 100 │</div><div class="line">│ 2018-09-14 │ 100 │</div><div class="line">│ 2018-09-15 │ 100 │</div><div class="line">└────────────┴─────┘</div></pre></td></tr></table></figure>
<hr>
<h3 id="Bug修复："><a href="#Bug修复：" class="headerlink" title="Bug修复："></a>Bug修复：</h3><ul>
<li>修复了<code>Dictionary</code>表的问题（抛出<code>Size of offsets doesn&#39;t match size of column</code>或<code>Unknown compression method</code>异常）。此错误出现在版本18.10.3中。<a href="https://github.com/yandex/ClickHouse/issues/2913" target="_blank" rel="external">＃2913</a></li>
<li>修复了合并<code>CollapsingMergeTree</code>表时如果其中一个数据部分为空（这些部分是在合并期间形成或者<code>ALTER DELETE</code>所有数据都已删除）的错误，并且该<code>vertical</code>算法用于合并。<a href="https://github.com/yandex/ClickHouse/pull/3049" target="_blank" rel="external">＃3049</a></li>
<li>在修正了比赛条件<code>DROP</code>或<code>TRUNCATE</code>用于<code>Memory</code>与同时表<code>SELECT</code>，这可能导致服务器崩溃。此错误出现在1.1.54388版本中。<a href="https://github.com/yandex/ClickHouse/pull/3038" target="_blank" rel="external">＃3038</a></li>
<li>修复了在返回错误时插入<code>Replicated</code>表时数据丢失的可能性<code>Session is expired</code>（可以通过<code>ReplicatedDataLoss</code>度量检测到数据丢失）。版本1.1.54378中发生此错误。<a href="https://github.com/yandex/ClickHouse/pull/2939" target="_blank" rel="external">＃2939 </a><a href="https://github.com/yandex/ClickHouse/pull/2949" target="_blank" rel="external">＃2949 </a><a href="https://github.com/yandex/ClickHouse/pull/2964" target="_blank" rel="external">＃2964</a></li>
<li>修复了一段时间内的段错误<code>JOIN ... ON</code>。<a href="https://github.com/yandex/ClickHouse/pull/3000" target="_blank" rel="external">＃3000</a></li>
<li>修复了<code>WHERE</code>表达式完全由限定列名称组成时的错误搜索列名称，例如<code>WHERE table.column</code>。<a href="https://github.com/yandex/ClickHouse/pull/2994" target="_blank" rel="external">＃2994</a></li>
<li>修复了在执行分布式查询时发生的“未找到列”错误，如果从远程服务器请求包含带有子查询的IN表达式的单个列。<a href="https://github.com/yandex/ClickHouse/pull/3087" target="_blank" rel="external">＃3087</a></li>
<li>修复了<code>Block structure mismatch in UNION stream: different number of columns</code>分布式查询发生的错误，如果其中一个分片是本地分区而另一个分片不是，并且<code>PREWHERE</code>触发了移动优化。<a href="https://github.com/yandex/ClickHouse/pull/2226" target="_blank" rel="external">＃2226 </a><a href="https://github.com/yandex/ClickHouse/pull/3037" target="_blank" rel="external">＃3037 </a><a href="https://github.com/yandex/ClickHouse/pull/3055" target="_blank" rel="external">＃3055 </a><a href="https://github.com/yandex/ClickHouse/pull/3065" target="_blank" rel="external">＃3065 </a><a href="https://github.com/yandex/ClickHouse/pull/3073" target="_blank" rel="external">＃3073 </a><a href="https://github.com/yandex/ClickHouse/pull/3090" target="_blank" rel="external">＃3090 </a><a href="https://github.com/yandex/ClickHouse/pull/3093" target="_blank" rel="external">＃3093</a></li>
<li>修复了<code>pointInPolygon</code>非凸多边形的某些情况的函数。<a href="https://github.com/yandex/ClickHouse/pull/2910" target="_blank" rel="external">＃2910</a></li>
<li>修正了<code>nan</code>与整数比较时的错误结果。<a href="https://github.com/yandex/ClickHouse/pull/3024" target="_blank" rel="external">＃3024</a></li>
<li>修复了<code>zlib-ng</code>库中可能导致段错误的错误。<a href="https://github.com/yandex/ClickHouse/pull/2854" target="_blank" rel="external">＃2854</a></li>
<li>修复了插入带有<code>AggregateFunction</code>列的表时的内存泄漏，如果聚合函数的状态不简单（单独分配内存），以及单个插入请求是否导致多个小块。<a href="https://github.com/yandex/ClickHouse/pull/3084" target="_blank" rel="external">＃3084</a></li>
<li>修复了同时创建和删除相同<code>Buffer</code>或<code>MergeTree</code>表格时的竞争条件。</li>
<li>修复了比较由某些非平凡类型组成的元组（例如元组）时出现段错误的可能性。<a href="https://github.com/yandex/ClickHouse/pull/2989" target="_blank" rel="external">＃2989</a></li>
<li>修复了运行某些<code>ON CLUSTER</code>查询时出现段错误的可能性。<a href="https://github.com/yandex/ClickHouse/pull/2960" target="_blank" rel="external">张冬</a></li>
<li>修复了数组元素<code>arrayDistinct</code>函数中的错误<code>Nullable</code>。<a href="https://github.com/yandex/ClickHouse/pull/2845" target="_blank" rel="external">＃2845 </a><a href="https://github.com/yandex/ClickHouse/pull/2937" target="_blank" rel="external">＃2937</a></li>
<li>该<code>enable_optimize_predicate_expression</code>选项现在可以正确支持案例<code>SELECT *</code>。<a href="https://github.com/yandex/ClickHouse/pull/2929" target="_blank" rel="external">张冬</a></li>
<li>修复了重新初始化ZooKeeper会话时的段错误。<a href="https://github.com/yandex/ClickHouse/pull/2917" target="_blank" rel="external">＃2917</a></li>
<li>修复了使用ZooKeeper时潜在的阻塞问题。</li>
<li>修复了在a中添加嵌套数据结构的错误代码<code>SummingMergeTree</code>。</li>
<li>在为聚合函数的状态分配内存时，正确地考虑了对齐，这使得在实现聚合函数的状态时可以使用需要对齐的操作。<a href="https://github.com/yandex/ClickHouse/pull/2808" target="_blank" rel="external">晨星-XC</a></li>
</ul>
<h3 id="安全修复："><a href="#安全修复：" class="headerlink" title="安全修复："></a><a href="https://github.com/yandex/ClickHouse/blob/master/CHANGELOG.md#security-fix" target="_blank" rel="external"></a>安全修复：</h3><ul>
<li>安全使用ODBC数据源。与ODBC驱动程序的交互使用单独的<code>clickhouse-odbc-bridge</code>进程。第三方ODBC驱动程序中的错误不再导致服务器稳定性或漏洞问题。<a href="https://github.com/yandex/ClickHouse/pull/2828" target="_blank" rel="external">＃2828 </a><a href="https://github.com/yandex/ClickHouse/pull/2879" target="_blank" rel="external">＃2879 </a><a href="https://github.com/yandex/ClickHouse/pull/2886" target="_blank" rel="external">＃2886 </a><a href="https://github.com/yandex/ClickHouse/pull/2893" target="_blank" rel="external">＃2893 </a><a href="https://github.com/yandex/ClickHouse/pull/2921" target="_blank" rel="external">＃2921</a></li>
<li>修复了<code>catBoostPool</code>表函数中文件路径的错误验证问题。<a href="https://github.com/yandex/ClickHouse/pull/2894" target="_blank" rel="external">＃2894</a></li>
<li>系统表（的内容<code>tables</code>，<code>databases</code>，<code>parts</code>，<code>columns</code>，<code>parts_columns</code>，<code>merges</code>，<code>mutations</code>，<code>replicas</code>，和<code>replication_queue</code>）根据用户的配置访问数据库过滤（<code>allow_databases</code>）。<a href="https://github.com/yandex/ClickHouse/pull/2856" target="_blank" rel="external">张冬</a></li>
</ul>
<h3 id="向后不兼容的变化："><a href="#向后不兼容的变化：" class="headerlink" title="向后不兼容的变化："></a><a href="https://github.com/yandex/ClickHouse/blob/master/CHANGELOG.md#backward-incompatible-changes" target="_blank" rel="external"></a>向后不兼容的变化：</h3><ul>
<li>在使用JOIN的请求中，星形字符扩展为所有表中的列列表，符合SQL标准。您可以通过<code>asterisk_left_columns_only</code>在用户配置级别设置为1 来恢复旧行为。</li>
</ul>
<h3 id="构建更改："><a href="#构建更改：" class="headerlink" title="构建更改："></a><a href="https://github.com/yandex/ClickHouse/blob/master/CHANGELOG.md#build-changes" target="_blank" rel="external"></a>构建更改：</h3><ul>
<li>现在大多数集成测试都可以通过提交来运行。</li>
<li>代码样式检查也可以通过提交运行。</li>
<li>在<code>memcpy</code>上CentOS7 / Fedora的建设时，实施正确选择。<a href="https://github.com/yandex/ClickHouse/pull/2912" target="_blank" rel="external">Etienne Champetier</a></li>
<li>使用clang进行构建时，<code>-Weverything</code>除了常规警告外，还添加了一些警告<code>-Wall-Wextra -Werror</code>。<a href="https://github.com/yandex/ClickHouse/pull/2957" target="_blank" rel="external">＃2957</a></li>
<li>调试构建使用<code>jemalloc</code>调试选项。</li>
<li>用于与ZooKeeper交互的库的接口被声明为abstract。<a href="https://github.com/yandex/ClickHouse/pull/2950" target="_blank" rel="external">＃2950</a></li>
</ul>
<hr>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://github.com/yandex/ClickHouse/blob/master/CHANGELOG.md" target="_blank" rel="external">https://github.com/yandex/ClickHouse/blob/master/CHANGELOG.md</a></li>
</ul>
<h2 id="RPM-Download"><a href="#RPM-Download" class="headerlink" title="RPM-Download"></a>RPM-Download</h2><ul>
<li><a href="https://packagecloud.io/app/altinity/clickhouse/search?q=18.12.13" target="_blank" rel="external">https://packagecloud.io/app/altinity/clickhouse/search?q=18.12.13</a></li>
<li><a href="https://pan.baidu.com/s/1ZC7I2XLZTWDHuXig2Ajb-A" target="_blank" rel="external">CentOS7 rpm 百度网盘</a></li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li>目前官方增加了很多针对问题排查以及性能监控相关的变量，相应的监控程序也需要升级了。</li>
<li>以clickhouse_exporter为例，它的主要工作原理，就是读取system库</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/新特性/" rel="tag"># 新特性</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/05/30/Superset-Introduce/" rel="next" title="可能是目前颜值最高的开源BI工具-Superset">
                <i class="fa fa-chevron-left"></i> 可能是目前颜值最高的开源BI工具-Superset
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/10/08/Notice/" rel="prev" title="Notice">
                Notice <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2018/09/16/ClickHouse-V-18-12-13-improvements/"
           data-title="ClickHouse 18.12.13-2018-09-10版本新特性解析" data-url="http://jackpgao.github.io/2018/09/16/ClickHouse-V-18-12-13-improvements/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Jack Gao" />
          <p class="site-author-name" itemprop="name">Jack Gao</p>
           
              <p class="site-description motion-element" itemprop="description">Done is better than perfect!</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/jackpgao/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#新特性列表（按照GitHub中CHANGELOG顺序）"><span class="nav-number">1.</span> <span class="nav-text">新特性列表（按照GitHub中CHANGELOG顺序）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#支持Decimal"><span class="nav-number">1.0.1.</span> <span class="nav-text">支持Decimal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#新的WITH-ROLLUP修饰符GROUP-BY，替代语法-GROUP-BY-ROLLUP-…"><span class="nav-number">1.0.2.</span> <span class="nav-text">新的WITH ROLLUP修饰符GROUP BY，替代语法 GROUP BY ROLLUP(…)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JOIN查询会把-解析为字段"><span class="nav-number">1.0.3.</span> <span class="nav-text">JOIN查询会把*解析为字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JOIN支持table-functions-remote-merge-numbers-url"><span class="nav-number">1.0.4.</span> <span class="nav-text">JOIN支持table functions(remote/merge/numbers/url)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#终端支持tab自动补全"><span class="nav-number">1.0.5.</span> <span class="nav-text">终端支持tab自动补全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#终端支持ctrl-c取消输入"><span class="nav-number">1.0.6.</span> <span class="nav-text">终端支持ctrl c取消输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可指定默认的JOIN行为"><span class="nav-number">1.0.7.</span> <span class="nav-text">可指定默认的JOIN行为</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#server-log关联查询ID"><span class="nav-number">1.0.8.</span> <span class="nav-text">server log关联查询ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#终端可以直接print日志"><span class="nav-number">1.0.9.</span> <span class="nav-text">终端可以直接print日志</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#记录setting行为到query-log"><span class="nav-number">1.0.10.</span> <span class="nav-text">记录setting行为到query_log</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#记录线程数"><span class="nav-number">1.0.11.</span> <span class="nav-text">记录线程数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#增加进程统计信息"><span class="nav-number">1.0.12.</span> <span class="nav-text">增加进程统计信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#新增每个查询执行线程的信息"><span class="nav-number">1.0.13.</span> <span class="nav-text">新增每个查询执行线程的信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#新增-system-metrics-and-system-events"><span class="nav-number">1.0.14.</span> <span class="nav-text">新增 system.metrics and system.events</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#新增arrayEnumerateDense函数"><span class="nav-number">1.0.15.</span> <span class="nav-text">新增arrayEnumerateDense函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#新增arrayCumSumNonNegativ-arrayDifference函数"><span class="nav-number">1.0.16.</span> <span class="nav-text">新增arrayCumSumNonNegativ/arrayDifference函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#新增retention函数"><span class="nav-number">1.0.17.</span> <span class="nav-text">新增retention函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#states函数可以使用加号云算法"><span class="nav-number">1.0.18.</span> <span class="nav-text">states函数可以使用加号云算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#虚拟列"><span class="nav-number">1.0.19.</span> <span class="nav-text">虚拟列</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bug修复："><span class="nav-number">1.1.</span> <span class="nav-text">Bug修复：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安全修复："><span class="nav-number">1.2.</span> <span class="nav-text">安全修复：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#向后不兼容的变化："><span class="nav-number">1.3.</span> <span class="nav-text">向后不兼容的变化：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#构建更改："><span class="nav-number">1.4.</span> <span class="nav-text">构建更改：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">2.</span> <span class="nav-text">Reference</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RPM-Download"><span class="nav-number">3.</span> <span class="nav-text">RPM-Download</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他"><span class="nav-number">4.</span> <span class="nav-text">其他</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jack Gao</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"JackpGao"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  













  
  

  

  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.0"></script>



  

</body>
</html>
